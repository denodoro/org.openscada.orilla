<?xml version="1.0" encoding="UTF-8"?>
<!-- ====================================================================== 
     OpenSCADA RCP Client (Setup)
                   
     Jens Reimann                                                                
     ====================================================================== -->
<project name="ostc_setup" default="default" basedir=".">
    <description>
    	OpenSCADA RCP Client (Setup)
    </description>
	
	<!-- properties -->
	<property file="build.properties"/>
	<property file="local.properties"/>
	
	<property name="platformName" value="win32.win32.x86"/>
	<property name="advinst.base" location="/home/user/AdvancedInstaller"/>

	<property name="ostc.download.base" value="http://download.openscada.org/atlantis"/>
	<property name="ostc.download.buildType" value="I"/>
	<property name="ostc.download.buildId" value="0.14.0"/>
	<property name="ostc.download.uri" value="${ostc.download.base}/${ostc.download.buildType}/${ostc.download.buildId}/ostc"/>
	
	<property name="deploy.base" location="${java.io.tmpdir}/deploy-msi"/>
	
	<property name="builder" location="build.${platformName}"/>
	
	<!-- ================================= 
          target: default              
         ================================= -->
    <target name="default" depends="init,clean,download,build" description="Build the setup">
    </target>
	
	<!-- ================================= 
          target: init              
         ================================= -->
    <target name="init" depends="" description="Initialize">
        <echo message="Building: ${platformName} / ${version}"/>
    </target>
	
	<!-- ================================= 
          target: download              
         ================================= -->
    <target name="download" depends="" description="Download the source package">
		<mkdir dir="${builder}"/>
    	<get src="${ostc.download.uri}/ostc-${platformName}.zip" dest="${builder}/ostc.zip"/>
    	
    	<unzip dest="${builder}/ostc" src="${builder}/ostc.zip"/>
    </target>
	
	<!-- ================================= 
          target: clean              
         ================================= -->
    <target name="clean" depends="" description="Clean up">
    	<delete dir="${builder}" failonerror="false"/>
    </target>

	<!-- ================================= 
          target: build              
         ================================= -->
    <target name="build" depends="" description="Build the setup">
    	<echo message="Setting version to ${version}"/>
        <copy file="ostc_setup_${platformName}.aip" todir="${builder}"/>
    	<exec executable="${advinst.base}/AdvancedInstaller.com" dir="${builder}" failonerror="true">
    		<arg value="/edit"/>
    		<arg value="ostc_setup_${platformName}.aip"/>
    		<arg value="/SetVersion"/>
    		<arg value="${version}"/>
    	</exec>
    	<exec executable="${advinst.base}/AdvancedInstaller.com" dir="${builder}" failonerror="true">
    		<arg value="/build"/>
    		<arg value="ostc_setup_${platformName}.aip"/>
    	</exec>
    </target>
	
</project>