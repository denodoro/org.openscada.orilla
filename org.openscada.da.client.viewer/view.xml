<?xml version="1.0" encoding="UTF-8"?>

<viewer:root
  xmlns:common="http://openscada.org/Common"
  xmlns:viewer="http://openscada.org/DA/Viewer"
  xmlns:template="http://openscada.org/DA/Viewer/Template"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://openscada.org/DA/Viewer schema/Viewer.xsd http://openscada.org/Common http://schema.openscada.org/Common.xsd http://openscada.org/DA/Viewer/Template schema/TemplateObject.xsd"
  >
  
	<factories>
		<container-factory id="figure" class="org.openscada.da.client.viewer.model.impl.containers.FigureContainerFactory"/>
		<container-factory id="view" class="org.openscada.da.client.viewer.model.impl.containers.BasicViewFactory"/>
		<container-factory id="hidden" class="org.openscada.da.client.viewer.model.impl.containers.HiddenContainerFactory"/>
		<container-factory id="command" class="org.openscada.da.client.viewer.model.impl.containers.CommandContainer"/>
		<container-factory id="entryCommand" class="org.openscada.da.client.viewer.model.impl.containers.EntryCommandContainer"/>
		
		<object-factory id="line" class="org.openscada.da.client.viewer.model.impl.figures.Line"/>
		<object-factory id="polyline" class="org.openscada.da.client.viewer.model.impl.figures.Polyline"/>
		<object-factory id="label" class="org.openscada.da.client.viewer.model.impl.figures.Label"/>
		<object-factory id="rectangle" class="org.openscada.da.client.viewer.model.impl.figures.Rectangle"/>
		<object-factory id="ellipse" class="org.openscada.da.client.viewer.model.impl.figures.Ellipse"/>
		<object-factory id="triangle" class="org.openscada.da.client.viewer.model.impl.figures.Triangle"/>
		<object-factory id="item" class="org.openscada.da.client.viewer.model.impl.items.DataItemObject"/>
		<object-factory id="viewLink" class="org.openscada.da.client.viewer.model.impl.figures.ViewLink"/>
		<object-factory id="commandButton" class="org.openscada.da.client.viewer.model.impl.figures.CommandButton"/>
		
		<object-factory id="percentBar" class="org.openscada.da.client.viewer.model.impl.widgets.PercentBar"/>
		
		<object-factory id="colorcomposer" class="org.openscada.da.client.viewer.model.impl.converter.ColorComposer"/>
		<object-factory id="modulo" class="org.openscada.da.client.viewer.model.impl.converter.ModuloCalculator"/>
		<object-factory id="factor" class="org.openscada.da.client.viewer.model.impl.converter.FactorCalculator"/>
		
		<object-factory id="variantasboolean" class="org.openscada.da.client.viewer.model.impl.converter.VariantBooleanConverter"/>
		<object-factory id="variantasinteger" class="org.openscada.da.client.viewer.configurator.xml.XMLObjectFactory">
			<arg class="org.openscada.da.client.viewer.model.impl.converter.SimpleVariantIntegerConverter"/>
		</object-factory>
		<object-factory id="variantasdouble" class="org.openscada.da.client.viewer.configurator.xml.XMLObjectFactory">
			<arg class="org.openscada.da.client.viewer.model.impl.converter.SimpleVariantDoubleConverter"/>
		</object-factory>
		<object-factory id="d2i" class="org.openscada.da.client.viewer.configurator.xml.XMLObjectFactory">
			<arg class="org.openscada.da.client.viewer.model.impl.converter.Double2IntegerConverter"/>
		</object-factory>
		
		<object-factory id="if" class="org.openscada.da.client.viewer.model.impl.converter.If"/>
		<object-factory id="boolean2matrix" class="org.openscada.da.client.viewer.model.impl.converter.Boolean2Matrix"/>

		<object-factory id="mov-cmd" class="org.openscada.da.client.viewer.configurator.xml.XMLTemplateFactory">
			<template:template id="mov-cmd" type="figure">
				<objects>					
					<container type="command" id="c1">
						<property name="commands">open-command|Open,close-command|Close</property>
		
						<objects>
							<template-object template="mov" id="mov1"/>
						</objects>
						
						<connectors>
						</connectors>
						
						<inputs>
							<input-export object="mov1" name="open-signal" export-name="open-signal"/>
							<input-export object="mov1" name="close-signal" export-name="close-signal"/>
						</inputs>
						
					</container>
				</objects>

				<connectors>
				</connectors>

				<outputs>
					<output-export object="c1" name="open-command" export-name="open-command"/>
					<output-export object="c1" name="close-command" export-name="close-command"/>
				</outputs>

				<inputs>
					<input-export object="c1" name="open-signal" export-name="open-signal"/>
					<input-export object="c1" name="close-signal" export-name="close-signal"/>
				</inputs>
				
			</template:template>
		</object-factory>
				
		<object-factory id="mov" class="org.openscada.da.client.viewer.configurator.xml.XMLTemplateFactory">
			<template:template id="mov" type="figure">

				<objects>
					<constant id="mov_fatal"><color red="255" green="0" blue="255"/></constant>
					<constant id="mov_opened"><color red="0" green="255" blue="0"/></constant>
					<constant id="mov_transit"><color red="255" green="255" blue="0"/></constant>
					<constant id="mov_closed"><null/></constant>
					<constant id="mov_error"><color red="255" green="0" blue="0"/></constant>
					
					<object type="rectangle" id="rect1">
						<property name="x">0</property>
						<property name="y">0</property>
						<property name="width">24</property>
						<property name="height">24</property>
					</object>
					<object type="triangle" id="tri1">
						<property name="x">2</property>
						<property name="y">2</property>
						<property name="width">10</property>
						<property name="height">20</property>
						<property name="direction">2</property>
					</object>
					<object type="triangle" id="tri2">
						<property name="x">12</property>
						<property name="y">2</property>
						<property name="width">10</property>
						<property name="height">20</property>
						<property name="direction">8</property>
					</object>
					<object type="boolean2matrix" id="oc_matrix_1"/>
					<object type="variantasboolean" id="v2b_opened"/>
					<object type="variantasboolean" id="v2b_closed"/>

				</objects>
				<connectors>
					<connector type="default">
						<output object="mov_fatal" name="value"/>
						<input object="oc_matrix_1" name="defaultValue"/>
					</connector>
					<connector type="default">
						<output object="mov_transit" name="value"/>
						<input object="oc_matrix_1" name="value00"/>
					</connector>
					<connector type="default">
						<output object="mov_opened" name="value"/>
						<input object="oc_matrix_1" name="value01"/>
					</connector>
					<connector type="default">
						<output object="mov_closed" name="value"/>
						<input object="oc_matrix_1" name="value10"/>
					</connector>
					<connector type="default">
						<output object="mov_error" name="value"/>
						<input object="oc_matrix_1" name="value11"/>
					</connector>
					<connector type="default">
						<output object="oc_matrix_1" name="value"/>
						<input object="tri1" name="backgroundColor"/>
					</connector>
					<connector type="default">
						<output object="oc_matrix_1" name="value"/>
						<input object="tri2" name="backgroundColor"/>
					</connector>
					
					<connector type="default">
						<output object="v2b_opened" name="value"/>
						<input object="oc_matrix_1" name="valueA"/>
					</connector>
					<connector type="default">
						<output object="v2b_closed" name="value"/>
						<input object="oc_matrix_1" name="valueB"/>
					</connector>
					
				</connectors>
				<outputs>
				</outputs>
				
				<inputs>
					<input-export object="v2b_opened" name="value" export-name="open-signal"/>
					<input-export object="v2b_closed" name="value" export-name="close-signal"/>
				</inputs>
				
			</template:template>
		</object-factory>
		
		<object-factory id="variant_cc" class="org.openscada.da.client.viewer.configurator.xml.XMLTemplateFactory">
			<template:template id="variant_cc" type="hidden">
				<objects>
					<object type="colorcomposer" id="cc">
						<property name="red">0</property>
						<property name="green">0</property>
						<property name="blue">0</property>
					</object>
					<object type="variantasinteger" id="vai_r"/>
					<object type="variantasinteger" id="vai_g"/>
					<object type="variantasinteger" id="vai_b"/>
					<object type="modulo" id="mod_r"><property name="modulo">255</property></object>
					<object type="modulo" id="mod_g"><property name="modulo">255</property></object>
					<object type="modulo" id="mod_b"><property name="modulo">255</property></object>
				</objects>
				
				<connectors>
				
					<connector type="default">
						<output object="vai_r" name="value"/>
						<input object="mod_r" name="value"/>
					</connector>
					<connector type="default">
						<output object="mod_r" name="value"/>
						<input object="cc" name="red"/>
					</connector>
					
					<connector type="default">
						<output object="vai_g" name="value"/>
						<input object="mod_g" name="value"/>
					</connector>
					<connector type="default">
						<output object="mod_g" name="value"/>
						<input object="cc" name="green"/>
					</connector>
					
					<connector type="default">
						<output object="vai_b" name="value"/>
						<input object="mod_b" name="value"/>
					</connector>
					<connector type="default">
						<output object="mod_b" name="value"/>
						<input object="cc" name="blue"/>
					</connector>
					
				</connectors>
				<outputs>
					<output-export object="cc" name="color" export-name="color"/>
				</outputs>
				<inputs>
					<input-export object="vai_r" name="value" export-name="red"/>
					<input-export object="vai_g" name="value" export-name="green"/>
					<input-export object="vai_b" name="value" export-name="blue"/>
				</inputs>
			</template:template>
		</object-factory>
		
		<connector-factory id="default" class="org.openscada.da.client.viewer.model.impl.PassThroughConnectorFactory"/>
		<connector-factory id="display" class="org.openscada.da.client.viewer.model.impl.DisplaySynchronizedConnectorFactory"/>
	</factories>
	
	<views>
		<view id="mainView" type="view">
			
			<property name="backgroundColor">#FFFFFF</property>
			<property name="opaque">true</property>
			
			<objects>
				
				<object id="mov1_cmd_open" type="item">
					<property name="item">mov.1000.open-command</property>
					<property name="connection">da:net://localhost:1202?auto-reconnect=true</property>
				</object>
				<object id="mov1_cmd_close" type="item">
					<property name="item">mov.1000.close-command</property>
					<property name="connection">da:net://localhost:1202?auto-reconnect=true</property>
				</object>

				<object id="mov1_open" type="item">
					<property name="item">mov.1000.open-signal</property>
					<property name="connection">da:net://localhost:1202?auto-reconnect=true</property>
				</object>
				<object id="mov1_close" type="item">
					<property name="item">mov.1000.close-signal</property>
					<property name="connection">da:net://localhost:1202?auto-reconnect=true</property>
				</object>
			
				<template-object template="mov-cmd" id="mov-cmd-1">
					<property name="x">10</property>
					<property name="y">10</property>
				</template-object>
				
				<object type="label" id="mov-cmd-label-1">
					<property name="text">MOV 1000</property>
					<property name="x">100</property>
					<property name="y">15</property>
				</object>
				
				<object type="label" id="description-1">
					<property name="text">Click on the MOV to see the command menu.</property>
					<property name="x">400</property>
					<property name="y">15</property>
					<property name="width">200</property>
					<property name="height">30</property>
				</object>
			
				<template-object template="mov-cmd" id="mov-cmd-2">
					<property name="x">10</property>
					<property name="y">60</property>
				</template-object>
				
				<object type="label" id="mov-cmd-label-2">
					<property name="text">MOV 1000 (commands unconnected)</property>
					<property name="x">100</property>
					<property name="y">65</property>
				</object>
				
				<template-object template="mov-cmd" id="mov-cmd-3">
					<property name="x">10</property>
					<property name="y">110</property>
				</template-object>
				
				<object type="label" id="mov-cmd-label-3">
					<property name="text">MOV unconnected</property>
					<property name="x">100</property>
					<property name="y">115</property>
				</object>
				
				<object type="label" id="description-3">
					<property name="text">If the simulation server is not started the MOVs will all shown in purple. Start the simulation server and wait at least 10 seconds until the automatic re-connect will bind the visualization to the data items.</property>
					<property name="x">400</property>
					<property name="y">65</property>
					<property name="width">200</property>
					<property name="height">100</property>
				</object>
								
				<object type="viewLink" id="view1">
					<property name="text">View 1</property>
					<property name="x">20</property>
					<property name="y">150</property>
					<property name="opaque">true</property>
					<property name="viewId">scaleView</property>
					<property name="backgroundColor">#BBBBBB</property>
				</object>
				
				<object type="viewLink" id="view2">
					<property name="text">View 2</property>
					<property name="x">80</property>
					<property name="y">150</property>
					<property name="opaque">true</property>
					<property name="viewId">figureView</property>
					<property name="backgroundColor">#BBBBBB</property>
				</object>
				
			</objects>
			
			<connectors>
			
				<connector type="display">
					<output object="mov1_open" name="value"/>
					<input object="mov-cmd-1" name="open-signal"/>
				</connector>
				<connector type="display">
					<output object="mov1_close" name="value"/>
					<input object="mov-cmd-1" name="close-signal"/>
				</connector>
				<connector type="default">
					<output object="mov-cmd-1" name="open-command"/>
					<input object="mov1_cmd_open" name="value"/>
				</connector>
				<connector type="default">
					<output object="mov-cmd-1" name="close-command"/>
					<input object="mov1_cmd_close" name="value"/>
				</connector>
				
				<connector type="display">
					<output object="mov1_open" name="value"/>
					<input object="mov-cmd-2" name="open-signal"/>
				</connector>
				<connector type="display">
					<output object="mov1_close" name="value"/>
					<input object="mov-cmd-2" name="close-signal"/>
				</connector>
				
			</connectors>
		</view>
		
		<view id="scaleView" type="view">
			
			<property name="backgroundColor">#FFFFFF</property>
			<property name="opaque">true</property>
		
			<objects>
			
				<constant id="null_variant"><variant><null/></variant></constant>
				<constant id="value_error_color"><color red="255" green="0" blue="255"/></constant>
				<constant id="value_ok_color"><null/></constant>
				
				<constant id="active_color"><color red="0" green="255" blue="0"/></constant>
				<constant id="inactive_color"><null/></constant>
								
				<object id="scale_1001_value" type="item">
					<property name="item">scale.1001.value</property>
					<property name="connection">da:net://localhost:1202?auto-reconnect=true</property>
				</object>
				
				<object id="scale_1001_active" type="item">
					<property name="item">scale.1001.active</property>
					<property name="connection">da:net://localhost:1202?auto-reconnect=true</property>
				</object>
				
				<object id="id_sim" type="item">
					<property name="item">memory</property>
					<property name="connection">da:net://localhost:1203?auto-reconnect=true</property>
				</object>
				
				<object type="variantasinteger" id="vai_scale_value"/>
			
				<object type="label" id="id_label">
					<property name="format">Identification: %s</property>
				</object>
			
				<container type="entryCommand" id="weight_container">
					<property name="x">10</property>
					<property name="y">150</property>
					<objects>
						<object type="label" id="weight_label">
							<property name="format">%d kg</property>
							<property name="opaque">true</property>
							<property name="fontSize">20</property>
						</object>
					</objects>
					<connectors/>
					<inputs>
						<input-export object="weight_label" name="object" export-name="weightValue"/>
					</inputs>
				</container>
				
				<object type="commandButton" id="start_weight_button">
					<property name="text">Start</property>
					<property name="x">10</property>
					<property name="y">190</property>
					<property name="fontSize">20</property>
					<property name="backgroundColor">#BBBBBB</property>
 					<property name="opaque">true</property>
				</object>
				<object id="start_weight_command_item" type="item">
					<property name="item">scale.1001.start</property>
					<property name="connection">da:net://localhost:1202?auto-reconnect=true</property>
				</object>

				<object type="variantasboolean" id="vab_scale_active"/>
				<object type="if" id="if_active_color"/>
				<object type="if" id="if_error_value_color"/>
			</objects>
			
			<connectors>
				<connector type="default">
					<output object="scale_1001_value" name="value"/>
					<input object="vai_scale_value" name="value"/>
				</connector>
				<connector type="display">
					<output object="vai_scale_value" name="value"/>
					<input object="weight_container" name="weightValue"/>
				</connector>
				
				<!-- active color -->
				<connector type="default">
					<output object="active_color" name="value"/>
					<input object="if_active_color" name="trueValue"/>
				</connector>
				<connector type="default">
					<output object="inactive_color" name="value"/>
					<input object="if_active_color" name="falseValue"/>
				</connector>
				
				<connector type="default">
					<output object="scale_1001_active" name="value"/>
					<input object="vab_scale_active" name="value"/>
				</connector>
				<connector type="default">
					<output object="vab_scale_active" name="value"/>
					<input object="if_active_color" name="conditionValue"/>
				</connector>
				<connector type="display">
					<output object="if_active_color" name="value"/>
					<input object="weight_container" name="backgroundColor"/>
				</connector>
				
				<!-- error color -->
				<connector type="default">
					<output object="value_error_color" name="value"/>
					<input object="if_error_value_color" name="trueValue"/>
				</connector>
				<connector type="default">
					<output object="value_ok_color" name="value"/>
					<input object="if_error_value_color" name="falseValue"/>
				</connector>
				
				<connector type="default">
					<output object="vai_scale_value" name="error"/>
					<input object="if_error_value_color" name="conditionValue"/>
				</connector>
				<connector type="display">
					<output object="if_error_value_color" name="value"/>
					<input object="weight_container" name="color"/>
				</connector>
				
				<connector type="default">
					<output object="null_variant" name="value"/>
					<input object="start_weight_button" name="value"/>
				</connector>
				<connector type="default">
					<output object="start_weight_button" name="value"/>
					<input object="start_weight_command_item" name="value"/>
				</connector>
				
				<!-- connection id-sim to entryCommand -->
				<connector type="default">
					<output object="weight_container" name="value"/>
					<input object="id_sim" name="value"/>
				</connector>
				
				<!-- connection from the memory cell to the memory label -->
				<connector type="display">
					<output object="id_sim" name="value"/>
					<input object="id_label" name="object"/>
				</connector>
			</connectors>
		</view>
		
		<view type="view" id="figureView">
			<property name="backgroundColor">#FFFFFF</property>
			<property name="opaque">true</property>
			
			<objects>

				<object type="ellipse" id="ellipse1">
					<property name="x">10</property>
					<property name="y">10</property>
					<property name="width">50</property>
					<property name="height">50</property>
					<property name="outline">true</property>
					<property name="fill">true</property>
					<property name="color">#FF0000</property>
					<property name="backgroundColor">#00FF00</property>
				</object>

				<object type="ellipse" id="ellipse2">
					<property name="x">25</property>
					<property name="y">10</property>
					<property name="width">75</property>
					<property name="height">50</property>
					<property name="outline">false</property>
					<property name="fill">true</property>
					<property name="fillXOR">true</property>
					<property name="color">#00FF00</property>
					<property name="backgroundColor">#0000FF</property>
				</object>
				
				<object type="line" id="line1">
					<property name="x1">10</property>
					<property name="y1">40</property>
					<property name="x2">200</property>
					<property name="y2">40</property>
					<property name="lineWidth">5</property>
					<property name="color">#FF0000</property>
					<property name="opaque">true</property>
				</object>

				<object type="polyline" id="polyline1">
					<property name="pointList">(10,100),(50,100),(10,150),(50,150)</property>
					<property name="color">#000000</property>
				</object>
				
				<object type="percentBar" id="percentbar1">
					<property name="x">10</property>
					<property name="y">200</property>
					<property name="width">200</property>
					<property name="height">70</property>
					<property name="min">0</property>
					<property name="max">255</property>
					<property name="label">NXT Ultrasonic Sensor (Port 4)</property>
					
					<property name="valueColor">#0000FF</property>
					<property name="invalidColor">#FF00FF</property>
				</object>

				<object id="nxt_ultrasonic" type="item">
					<property name="item">usb.sensor.3.value</property>
					<property name="connection">da:net://localhost:1202?auto-reconnect=true</property>
				</object>
				
				<object type="percentBar" id="percentbar2">
					<property name="x">250</property>
					<property name="y">200</property>
					<property name="width">200</property>
					<property name="height">70</property>
					<property name="min">0</property>
					<property name="max">1024</property>
					<property name="label">NXT Light Sensor (Port 3)</property>
					
					<property name="valueColor">#00FF00</property>
					<property name="invalidColor">#FF00FF</property>
				</object>

				<object id="nxt_light" type="item">
					<property name="item">usb.sensor.2.value</property>
					<property name="connection">da:net://localhost:1202?auto-reconnect=true</property>
				</object>
								
			</objects>
			
			<connectors>
			
				<connector type="display">
					<output object="nxt_ultrasonic" name="value"/>
					<input object="percentbar1" name="value"/>
				</connector>
				
				<connector type="display">
					<output object="nxt_light" name="value"/>
					<input object="percentbar2" name="value"/>
				</connector>
				
			</connectors>
		</view>
		
	</views>
</viewer:root>